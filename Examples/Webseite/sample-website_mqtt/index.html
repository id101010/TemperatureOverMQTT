<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>MQTT test client</title>
    <meta name="description" content="An example for using the MQTT library.">
    <script type="text/javascript" src="mqttws31.js"></script>
    <script type="text/javascript">
        // Parameters
        var hostname = "147.87.98.17";
        var port = 9001;

        // Create a client instance
        var client = new Paho.MQTT.Client(hostname, Number(port), "clientId");

        // Set callback handlers
        client.onConnectionLost = onConnectionLost;
        client.onMessageArrived = onMessageArrived;

        // Connect the client
        client.connect({
            userName: "tester",
            password: "test",
            onSuccess: onConnect,
            onFailure: onConnectionFailure
        });

        // Called when the client connects
        function onConnect() {
            // Once a connection has been made, make a subscription and send a message.
            console.log("onConnect");
            client.subscribe("test/#");
        }

        // Called when the client could not connect
        function onConnectionFailure() {
            console.log("onConnectionFailure");
        }

        // Called when the client loses its connection
        function onConnectionLost(responseObject) {
            if (responseObject.errorCode !== 0) {
                console.log("onConnectionLost:" + responseObject.errorMessage);
            }
        }

        // Called when a message arrives
        function onMessageArrived(message) {
            console.log("Message arrived: topic=" + message.destinationName + ", message=" + message.payloadString);
        }

        function send() {
            if (!client) {
                return;
            }
            var message = new Paho.MQTT.Message("Hello");
            message.destinationName = "test/world";
            client.send(message);
        }
    </script>
</head>

<body>
    <button onclick="send()">Push a new message</button>
</body>

</html>